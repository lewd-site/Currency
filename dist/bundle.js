(()=>{var t={313:t=>{var e=function(){"use strict";function t(t,e){return null!=e&&t instanceof e}var e,s,i;try{e=Map}catch(t){e=function(){}}try{s=Set}catch(t){s=function(){}}try{i=Promise}catch(t){i=function(){}}function r(n,o,h,l,c){"object"==typeof o&&(h=o.depth,l=o.prototype,c=o.includeNonEnumerable,o=o.circular);var u=[],f=[],d="undefined"!=typeof Buffer;return void 0===o&&(o=!0),void 0===h&&(h=1/0),function n(h,p){if(null===h)return null;if(0===p)return h;var _,y;if("object"!=typeof h)return h;if(t(h,e))_=new e;else if(t(h,s))_=new s;else if(t(h,i))_=new i((function(t,e){h.then((function(e){t(n(e,p-1))}),(function(t){e(n(t,p-1))}))}));else if(r.__isArray(h))_=[];else if(r.__isRegExp(h))_=new RegExp(h.source,a(h)),h.lastIndex&&(_.lastIndex=h.lastIndex);else if(r.__isDate(h))_=new Date(h.getTime());else{if(d&&Buffer.isBuffer(h))return _=Buffer.allocUnsafe?Buffer.allocUnsafe(h.length):new Buffer(h.length),h.copy(_),_;t(h,Error)?_=Object.create(h):void 0===l?(y=Object.getPrototypeOf(h),_=Object.create(y)):(_=Object.create(l),y=l)}if(o){var g=u.indexOf(h);if(-1!=g)return f[g];u.push(h),f.push(_)}for(var v in t(h,e)&&h.forEach((function(t,e){var s=n(e,p-1),i=n(t,p-1);_.set(s,i)})),t(h,s)&&h.forEach((function(t){var e=n(t,p-1);_.add(e)})),h){var b;y&&(b=Object.getOwnPropertyDescriptor(y,v)),b&&null==b.set||(_[v]=n(h[v],p-1))}if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(h);for(v=0;v<k.length;v++){var m=k[v];(!(w=Object.getOwnPropertyDescriptor(h,m))||w.enumerable||c)&&(_[m]=n(h[m],p-1),w.enumerable||Object.defineProperty(_,m,{enumerable:!1}))}}if(c){var x=Object.getOwnPropertyNames(h);for(v=0;v<x.length;v++){var w,E=x[v];(w=Object.getOwnPropertyDescriptor(h,E))&&w.enumerable||(_[E]=n(h[E],p-1),Object.defineProperty(_,E,{enumerable:!1}))}}return _}(n,h)}function n(t){return Object.prototype.toString.call(t)}function a(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return r.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},r.__objToStr=n,r.__isDate=function(t){return"object"==typeof t&&"[object Date]"===n(t)},r.__isArray=function(t){return"object"==typeof t&&"[object Array]"===n(t)},r.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===n(t)},r.__getRegExpFlags=a,r}();t.exports&&(t.exports=e)},321:function(t,e,s){(function(){(t.exports=s(282)).version="5.1.2"}).call(this)},282:function(t,e,s){(function(){var e,i,r=[].splice,n=function(t,e){if(!(t instanceof e))throw new Error("Bound instance method accessed before binding")},a=[].indexOf;i=s(313),e=s(361).EventEmitter,t.exports=function(){class t extends e{constructor(t={}){super(),this.get=this.get.bind(this),this.mget=this.mget.bind(this),this.set=this.set.bind(this),this.mset=this.mset.bind(this),this.del=this.del.bind(this),this.take=this.take.bind(this),this.ttl=this.ttl.bind(this),this.getTtl=this.getTtl.bind(this),this.keys=this.keys.bind(this),this.has=this.has.bind(this),this.getStats=this.getStats.bind(this),this.flushAll=this.flushAll.bind(this),this.flushStats=this.flushStats.bind(this),this.close=this.close.bind(this),this._checkData=this._checkData.bind(this),this._check=this._check.bind(this),this._isInvalidKey=this._isInvalidKey.bind(this),this._wrap=this._wrap.bind(this),this._getValLength=this._getValLength.bind(this),this._error=this._error.bind(this),this._initErrors=this._initErrors.bind(this),this.options=t,this._initErrors(),this.data={},this.options=Object.assign({forceString:!1,objectValueSize:80,promiseValueSize:80,arrayValueSize:40,stdTTL:0,checkperiod:600,useClones:!0,deleteOnExpire:!0,enableLegacyCallbacks:!1,maxKeys:-1},this.options),this.options.enableLegacyCallbacks&&(console.warn("WARNING! node-cache legacy callback support will drop in v6.x"),["get","mget","set","del","ttl","getTtl","keys","has"].forEach((t=>{var e;e=this[t],this[t]=function(...t){var s,i;if(i=t,[...t]=i,[s]=r.call(t,-1),"function"!=typeof s)return e(...t,s);try{s(null,e(...t))}catch(t){s(t)}}}))),this.stats={hits:0,misses:0,keys:0,ksize:0,vsize:0},this.validKeyTypes=["string","number"],this._checkData()}get(e){var s;if(n(this,t),null!=(s=this._isInvalidKey(e)))throw s;return null!=this.data[e]&&this._check(e,this.data[e])?(this.stats.hits++,this._unwrap(this.data[e])):void this.stats.misses++}mget(e){var s,i,r,a,o;if(n(this,t),!Array.isArray(e))throw this._error("EKEYSTYPE");for(o={},i=0,a=e.length;i<a;i++){if(r=e[i],null!=(s=this._isInvalidKey(r)))throw s;null!=this.data[r]&&this._check(r,this.data[r])?(this.stats.hits++,o[r]=this._unwrap(this.data[r])):this.stats.misses++}return o}set(e,s,i){var r,a;if(n(this,t),this.options.maxKeys>-1&&this.stats.keys>=this.options.maxKeys)throw this._error("ECACHEFULL");if(this.options.forceString,null==i&&(i=this.options.stdTTL),null!=(r=this._isInvalidKey(e)))throw r;return a=!1,this.data[e]&&(a=!0,this.stats.vsize-=this._getValLength(this._unwrap(this.data[e],!1))),this.data[e]=this._wrap(s,i),this.stats.vsize+=this._getValLength(s),a||(this.stats.ksize+=this._getKeyLength(e),this.stats.keys++),this.emit("set",e,s),!0}mset(e){var s,i,r,a,o,h,l,c,u;if(n(this,t),this.options.maxKeys>-1&&this.stats.keys+e.length>=this.options.maxKeys)throw this._error("ECACHEFULL");for(i=0,h=e.length;i<h;i++){if(o=e[i],({key:a,val:u,ttl:c}=o),c&&"number"!=typeof c)throw this._error("ETTLTYPE");if(null!=(s=this._isInvalidKey(a)))throw s}for(r=0,l=e.length;r<l;r++)o=e[r],({key:a,val:u,ttl:c}=o),this.set(a,u,c);return!0}del(e){var s,i,r,a,o,h;for(n(this,t),Array.isArray(e)||(e=[e]),s=0,r=0,o=e.length;r<o;r++){if(a=e[r],null!=(i=this._isInvalidKey(a)))throw i;null!=this.data[a]&&(this.stats.vsize-=this._getValLength(this._unwrap(this.data[a],!1)),this.stats.ksize-=this._getKeyLength(a),this.stats.keys--,s++,h=this.data[a],delete this.data[a],this.emit("del",a,h.v))}return s}take(e){var s;return n(this,t),null!=(s=this.get(e))&&this.del(e),s}ttl(e,s){var i;if(n(this,t),s||(s=this.options.stdTTL),!e)return!1;if(null!=(i=this._isInvalidKey(e)))throw i;return!(null==this.data[e]||!this._check(e,this.data[e])||(s>=0?this.data[e]=this._wrap(this.data[e].v,s,!1):this.del(e),0))}getTtl(e){var s;if(n(this,t),e){if(null!=(s=this._isInvalidKey(e)))throw s;return null!=this.data[e]&&this._check(e,this.data[e])?this.data[e].t:void 0}}keys(){return n(this,t),Object.keys(this.data)}has(e){return n(this,t),null!=this.data[e]&&this._check(e,this.data[e])}getStats(){return n(this,t),this.stats}flushAll(e=!0){n(this,t),this.data={},this.stats={hits:0,misses:0,keys:0,ksize:0,vsize:0},this._killCheckPeriod(),this._checkData(e),this.emit("flush")}flushStats(){n(this,t),this.stats={hits:0,misses:0,keys:0,ksize:0,vsize:0},this.emit("flush_stats")}close(){n(this,t),this._killCheckPeriod()}_checkData(e=!0){var s,i,r;for(s in n(this,t),i=this.data)r=i[s],this._check(s,r);e&&this.options.checkperiod>0&&(this.checkTimeout=setTimeout(this._checkData,1e3*this.options.checkperiod,e),null!=this.checkTimeout&&null!=this.checkTimeout.unref&&this.checkTimeout.unref())}_killCheckPeriod(){if(null!=this.checkTimeout)return clearTimeout(this.checkTimeout)}_check(e,s){var i;return n(this,t),i=!0,0!==s.t&&s.t<Date.now()&&(this.options.deleteOnExpire&&(i=!1,this.del(e)),this.emit("expired",e,this._unwrap(s))),i}_isInvalidKey(e){var s;if(n(this,t),s=typeof e,a.call(this.validKeyTypes,s)<0)return this._error("EKEYTYPE",{type:typeof e})}_wrap(e,s,r=!0){var a;return n(this,t),this.options.useClones||(r=!1),a=Date.now(),{t:0===s?0:s?a+1e3*s:0===this.options.stdTTL?this.options.stdTTL:a+1e3*this.options.stdTTL,v:r?i(e):e}}_unwrap(t,e=!0){return this.options.useClones||(e=!1),null!=t.v?e?i(t.v):t.v:null}_getKeyLength(t){return t.toString().length}_getValLength(e){return n(this,t),"string"==typeof e?e.length:this.options.forceString?JSON.stringify(e).length:Array.isArray(e)?this.options.arrayValueSize*e.length:"number"==typeof e?8:"function"==typeof(null!=e?e.then:void 0)?this.options.promiseValueSize:("undefined"!=typeof Buffer&&null!==Buffer?Buffer.isBuffer(e):void 0)?e.length:null!=e&&"object"==typeof e?this.options.objectValueSize*Object.keys(e).length:"boolean"==typeof e?8:0}_error(e,s={}){var i;return n(this,t),(i=new Error).name=e,i.errorcode=e,i.message=null!=this.ERRORS[e]?this.ERRORS[e](s):"-",i.data=s,i}_initErrors(){var e,s,i;for(s in n(this,t),this.ERRORS={},i=this._ERRORS)e=i[s],this.ERRORS[s]=this.createErrorMessage(e)}createErrorMessage(t){return function(e){return t.replace("__key",e.type)}}}return t.prototype._ERRORS={ENOTFOUND:"Key `__key` not found",ECACHEFULL:"Cache max keys amount exceeded",EKEYTYPE:"The key argument has to be of type `string` or `number`. Found: `__key`",EKEYSTYPE:"The keys argument has to be an array.",ETTLTYPE:"The ttl argument has to be a number."},t}.call(this)}).call(this)},752:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.createApp=void 0;const r=i(s(406)),n=i(s(741)),a=i(s(5)),o=i(s(885)),h=i(s(552)),l=i(s(440)),c=i(s(97)),u=i(s(321)),f=i(s(832)),d=i(s(285));e.createApp=function(){const t=new u.default,e=new d.default,s=new f.default(t,e),i=new n.default;i.get("/api/v1/aliexpress",s.get);const p=new r.default;return p.use(a.default.contentSecurityPolicy({directives:{defaultSrc:["'self'"],baseUri:["'self'"],fontSrc:["'self'","https:","data:"],formAction:["'self'"],frameAncestors:["'self'"],imgSrc:["'self'","data:"],objectSrc:["'none'"],scriptSrc:["'self'","'unsafe-inline'"],styleSrc:["'self'","'unsafe-inline'"]}})),p.use(a.default.referrerPolicy()),p.use(a.default.noSniff()),p.use(a.default.dnsPrefetchControl()),p.use(a.default.hidePoweredBy()),p.use((0,o.default)()),p.use((0,h.default)()),p.use((0,l.default)()),p.use((0,c.default)("public",{maxAge:6048e5})),p.use(i.routes()),p.use(i.allowedMethods()),p}},913:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.config=void 0;const r=i(s(142)),n=s(168);r.default.config(),e.config={aliexpress:{itemUrl:n.env.ALIEXPRESS_ITEM_URL||""},http:{port:+(n.env.HTTP_PORT||3200)}},e.default=e.config},832:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AliexpressController=void 0;const s="aliexpress";class i{constructor(t,e){this.cache=t,this.aliexpressService=e,this.get=async t=>{const e=this.cache.get(s);if(void 0!==e)return t.set("Content-Type","application/json"),void(t.body={price:e});const i=await this.aliexpressService.getPrice();null!==i?(this.cache.set(s,i,3600),t.set("Content-Type","application/json"),t.body={price:i}):t.status=404}}}e.AliexpressController=i,e.default=i},607:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(685)),n=s(752),a=i(s(913)),o=(0,n.createApp)();r.default.createServer(o.callback()).listen(a.default.http.port)},285:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.AliexpressService=void 0;const r=i(s(89)),n=i(s(913)),a="text/html",o="Mozilla/5.0 (X11; Linux x86_64; rv:97.0) Gecko/20100101 Firefox/97.0";class h{constructor(){this.getPrice=async()=>{const t=await this._readCookie();let e;if(t.location.length){const s=await this._writeCookie(t.location),i=await(0,r.default)(s.location,{headers:{Accept:a,Cookie:s.cookies,"User-Agent":o},follow:1});e=await i.text()}else e=t.text;const s=e.match(/price:(\d+\.\d+);currency:RUB/i);return null===s?null:+s[1]},this._readCookie=async()=>{const t=await(0,r.default)(n.default.aliexpress.itemUrl,{headers:{Accept:a,"User-Agent":o},redirect:"manual"});return{location:t.headers.get("location")||"",text:await t.text()}},this._writeCookie=async t=>{const e=await(0,r.default)(t,{headers:{Accept:a,"User-Agent":o},redirect:"manual"});return{location:e.headers.get("location")||"",cookies:((e.headers.get("set-cookie")||"").match(/(xman_us_f|xman_f|ali_apache_track|ali_apache_tracktmp|e_id)=(.+?);\s/gi)||[]).join("")}}}}e.AliexpressService=h,e.default=h},885:t=>{"use strict";t.exports=require("@koa/cors")},142:t=>{"use strict";t.exports=require("dotenv")},406:t=>{"use strict";t.exports=require("koa")},552:t=>{"use strict";t.exports=require("koa-conditional-get")},440:t=>{"use strict";t.exports=require("koa-etag")},5:t=>{"use strict";t.exports=require("koa-helmet")},741:t=>{"use strict";t.exports=require("koa-router")},97:t=>{"use strict";t.exports=require("koa-static")},89:t=>{"use strict";t.exports=require("node-fetch-commonjs")},361:t=>{"use strict";t.exports=require("events")},685:t=>{"use strict";t.exports=require("http")},168:t=>{"use strict";t.exports=require("process")}},e={};!function s(i){var r=e[i];if(void 0!==r)return r.exports;var n=e[i]={exports:{}};return t[i].call(n.exports,n,n.exports,s),n.exports}(607)})();